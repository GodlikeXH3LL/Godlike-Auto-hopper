local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local excludedNames = {
    ["U3RT_SOVIETxKILLA"] = false,
    ["U3RT_KILLAxSOVIET"] = false,
}

local placeId = game.PlaceId

local function find18Or19PlayerServer()
    local cursor = nil
    repeat
        local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Desc&limit=100"
        if cursor then
            url = url .. "&cursor=" .. cursor
        end

        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url))
        end)

        if success and response and response.data then
            for _, server in ipairs(response.data) do
                if (server.playing == 18 or server.playing == 19) and server.maxPlayers == 20 and server.id ~= game.JobId then
                    return server.id
                end
            end
            cursor = response.nextPageCursor
        else
            break
        end
    until not cursor

    return nil
end

local function hopToServer()
    local serverId = find18Or19PlayerServer()
    if serverId then
        TeleportService:TeleportToPlaceInstance(placeId, serverId, LocalPlayer)
    else
        warn("No 18 or 19-player servers found! Retrying in 5 seconds...")
        task.delay(5, hopToServer)
    end
end

task.delay(48, hopToServer)

local function setupDiedListener(character)
    local hum = character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.Died:Connect(hopToServer)
    else
        character.ChildAdded:Connect(function(child)
            if child:IsA("Humanoid") then
                child.Died:Connect(hopToServer)
            end
        end)
    end
end

if LocalPlayer.Character then
    setupDiedListener(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(setupDiedListener)

task.spawn(function()
    while true do
        task.wait(2)
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.DisplayName == "U3RT_SOVIETxKILLA" then
                hopToServer()
                return
            end
        end
    end
end)

task.spawn(function()
    while true do
        task.wait(0.3)
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.Health = hum.MaxHealth
        end
    end
end)

local function getCharacter()
    return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

local function killTarget(target)
    local char = getCharacter()
    if char and target.Character then
        local root = target.Character:FindFirstChild("HumanoidRootPart")
        local leftHand = char:FindFirstChild("LeftHand")
        local rightHand = char:FindFirstChild("RightHand")
        if root and (leftHand or rightHand) then
            if leftHand then
                firetouchinterest(root, leftHand, 0)
                firetouchinterest(root, leftHand, 1)
            end
            if rightHand then
                firetouchinterest(root, rightHand, 0)
                firetouchinterest(root, rightHand, 1)
            end
        end
    end
end

getgenv().killAll = true

task.spawn(function()
    while getgenv().killAll do
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") then
                killTarget(p)
            end
        end
        task.wait(0.1)
    end
end)

getgenv().fastHit = true

task.spawn(function()
    while getgenv().fastHit do
        local plr = Players.LocalPlayer
        local tool = plr.Backpack:FindFirstChild("Punch")
        if tool then
            tool.Parent = plr.Character
        end
        local muscleEvent = plr:FindFirstChild("muscleEvent")
        if muscleEvent then
            muscleEvent:FireServer("punch", "rightHand")
            muscleEvent:FireServer("punch", "leftHand")
        end
        local punchTool = plr.Character and plr.Character:FindFirstChild("Punch")
        if punchTool then
            punchTool:Activate()
        end
        task.wait()
    end
end)

local function OptimizeGame()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Texture") or obj:IsA("Decal") then
            if not obj:IsDescendantOf(LocalPlayer.Character) then
                obj:Destroy()
            end
        end
    end

    local camera = workspace.CurrentCamera
    if camera then
        for _, part in ipairs(workspace:GetChildren()) do
            if (part:IsA("Part") or part:IsA("MeshPart")) then
                if (part.Position - camera.CFrame.Position).Magnitude > 500 then
                    part:Destroy()
                end
            end
        end
    end

    for _, gui in ipairs(LocalPlayer.PlayerGui:GetDescendants()) do
        if gui:IsA("ImageLabel") or gui:IsA("ImageButton") then
            gui.Image = ""
        end
    end

    collectgarbage("collect")
end

OptimizeGame()
