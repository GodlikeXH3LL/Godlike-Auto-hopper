local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

-- Excluded display names
local excludedNames = {
    ["TopKillsBrr"] = false,
}

-- Server hop function to find 18 or 19-player servers
local placeId = game.PlaceId

local function find18Or19PlayerServer()
    local cursor = nil
    repeat
        local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Desc&limit=100"
        if cursor then
            url = url.."&cursor="..cursor
        end

        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url, true))
        end)

        if success and response and response.data then
            for _, server in ipairs(response.data) do
                if (server.playing == 18 or server.playing == 19) and server.maxPlayers == 20 and server.id ~= game.JobId then
                    return server.id
                end
            end
            cursor = response.nextPageCursor
        else
            wait(1)
        end
    until not cursor

    return nil
end

-- Function to hop to a server
local function hopToServer()
    local serverId = find18Or19PlayerServer()
    if serverId then
        TeleportService:TeleportToPlaceInstance(placeId, serverId, LocalPlayer)
    else
        warn("No suitable servers found! Retrying in 5 seconds...")
        task.delay(5, hopToServer)
    end
end

-- Start hopping after 48 seconds
task.delay(48, hopToServer)

-- Died listener setup to hop server upon death
local function setupDiedListener(character)
    local hum = character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.Died:Connect(hopToServer)
    end
end

-- Setup on current character
if LocalPlayer.Character then
    setupDiedListener(LocalPlayer.Character)
end

-- Setup on future characters
LocalPlayer.CharacterAdded:Connect(setupDiedListener)

-- Detect specific player and hop
task.spawn(function()
    while task.wait(2) do
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.DisplayName == "TopKillsBrr" then
                hopToServer()
                return
            end
        end
    end
end)

-- Healing loop
task.spawn(function()
    while task.wait(0.3) do
        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.Health = hum.MaxHealth
        end
    end
end)




-- Auto equip and punch
task.spawn(function()
    local Backpack = LocalPlayer:WaitForChild("Backpack")
    local tool = Backpack:FindFirstChild("Punch") or Backpack:WaitForChild("Punch")

    repeat task.wait() until LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    humanoid:EquipTool(tool)

    while task.wait(0.05) do
        if tool.Parent == LocalPlayer.Character then
            tool:Activate()
        elseif tool.Parent == Backpack then
            humanoid:EquipTool(tool)
        end
    end
end)

-- Performance/FPS optimizations
for _, v in pairs(game:GetDescendants()) do
    if v:IsA("ParticleEmitter") or v:IsA("Smoke") or v:IsA("Fire") or v:IsA("Sparkles") then
        v.Enabled = false
    end
end

local lighting = game:GetService("Lighting")
lighting.GlobalShadows = false
lighting.FogEnd = 9e9
lighting.Brightness = 0
lighting.TimeOfDay = "00:00:00"

settings().Rendering.QualityLevel = Enum.QualityLevel.Level01

for _, v in pairs(game:GetDescendants()) do
    if v:IsA("Decal") or v:IsA("Texture") then
        v.Transparency = 1
    elseif v:IsA("BasePart") and not v:IsA("MeshPart") then
        v.Material = Enum.Material.SmoothPlastic
        local isPlayerPart = v.Parent and (v.Parent:FindFirstChildOfClass("Humanoid") or (v.Parent.Parent and v.Parent.Parent:FindFirstChildOfClass("Humanoid")))
        if not isPlayerPart then
            v.Reflectance = 0
        end
    end
end

for _, v in pairs(lighting:GetChildren()) do
    if v:IsA("BlurEffect") or v:IsA("SunRaysEffect") or v:IsA("ColorCorrectionEffect") or v:IsA("BloomEffect") or v:IsA("DepthOfFieldEffect") then
        v.Enabled = false
    end
end
