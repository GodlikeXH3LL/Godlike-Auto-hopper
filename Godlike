local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local placeId = game.PlaceId

local function find18Or19PlayerServer()
    local cursor = nil
    repeat
        local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Desc&limit=100"
        if cursor then
            url = url.."&cursor="..cursor
        end

        local success, response = pcall(function()
            return HttpService:GetAsync(url, true)
        end)

        if not success then
            break
        end

        success, response = pcall(function()
            return HttpService:JSONDecode(response)
        end)

        if success and response and response.data then
            for _, server in ipairs(response.data) do
                if (server.playing == 18 or server.playing == 19) and server.maxPlayers == 20 and server.id ~= game.JobId then
                    return server.id
                end
            end
            cursor = response.nextPageCursor
        else
            break
        end
    until not cursor

    return nil
end

local function hopToServer()
    local serverId = find18Or19PlayerServer()
    if serverId then
        TeleportService:TeleportToPlaceInstance(placeId, serverId, LocalPlayer)
    else
        warn("No 18 or 19-player servers found! Retrying in 5 seconds...")
        task.delay(5, hopToServer)
    end
end

task.delay(48, hopToServer)

local function setupDiedListener(character)
    local hum = character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.Died:Connect(hopToServer)
    else
        character.ChildAdded:Connect(function(child)
            if child:IsA("Humanoid") then
                child.Died:Connect(hopToServer)
            end
        end)
    end
end

if LocalPlayer.Character then
    setupDiedListener(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(setupDiedListener)

task.spawn(function()
    while true do
        task.wait(2)
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Name == "U3RT_SOVIETxKILLA" or player.Name == "U3RT_KILLAxSOVIET" then
                hopToServer()
                return
            end
        end
    end
end)

task.spawn(function()
    while true do
        task.wait(0.3)
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum and hum.Health < hum.MaxHealth then
            hum.Health = hum.MaxHealth
        end
    end
end)

local function getCharacter()
    return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

local function killTarget(target)
    local char = getCharacter()
    if char and target.Character then
        local root = target.Character:FindFirstChild("HumanoidRootPart")
        local leftHand = char:FindFirstChild("LeftHand") or char:FindFirstChild("Left Hand")
        local rightHand = char:FindFirstChild("RightHand") or char:FindFirstChild("Right Hand")
        if root and (leftHand or rightHand) then
            if leftHand then
                firetouchinterest(root, leftHand, 0)
                firetouchinterest(root, leftHand, 1)
            end
            if rightHand then
                firetouchinterest(root, rightHand, 0)
                firetouchinterest(root, rightHand, 1)
            end
        end
    end
end

getgenv().killAll = true

task.spawn(function()
    while getgenv().killAll do
        task.wait(0.1)
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character:FindFirstChild("Humanoid").Health > 0 then
                killTarget(p)
            end
        end
    end
end)

getgenv().fastHit = true

task.spawn(function()
    while getgenv().fastHit do
        local plr = Players.LocalPlayer
        local char = plr.Character
        if char then
            local tool = plr.Backpack:FindFirstChild("Punch")
            if tool then
                tool.Parent = char
            end
            local punchTool = char:FindFirstChild("Punch")
            if punchTool then
                local muscleEvent = plr:FindFirstChild("muscleEvent")
                if muscleEvent and muscleEvent:IsA("RemoteEvent") then
                    muscleEvent:FireServer("punch", "rightHand")
                    muscleEvent:FireServer("punch", "leftHand")
                end
                punchTool:Activate()
            end
        end
        task.wait()
    end
end)

local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local function OptimizeGame()
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Texture") or obj:IsA("Decal") then
            if not obj:IsDescendantOf(LocalPlayer.Character) then
                obj:Destroy()
            end
        elseif obj:IsA("BasePart") and not obj:IsDescendantOf(LocalPlayer.Character) then
            obj.Material = Enum.Material.SmoothPlastic
        elseif obj:IsA("SurfaceAppearance") then
            obj:Destroy()
        end
    end

    Lighting.GlobalShadows = false
    Lighting.FogEnd = 100000
    Lighting.Brightness = 1

    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("BloomEffect") or effect:IsA("BlurEffect") or 
           effect:IsA("SunRaysEffect") or effect:IsA("ColorCorrectionEffect") or 
           effect:IsA("DepthOfFieldEffect") then
            effect.Enabled = false
        end
    end

    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    for _, gui in ipairs(playerGui:GetDescendants()) do
        if gui:IsA("ImageLabel") or gui:IsA("ImageButton") then
            gui.Image = ""
        end
    end

    settings().Rendering.QualityLevel = Enum.RenderingQualityLevel.Level01
end

OptimizeGame()

task.spawn(function()
    while true do
        task.wait(10)
        OptimizeGame()
    end
end)
